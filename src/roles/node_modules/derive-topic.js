const b4a = require('b4a')
const datdot_crypto = require('datdot-crypto')

module.exports = deriveTopicKey

function deriveTopicKey ({ id, senderKey, feedkey, receiverKey, log }) {
  senderKey = Buffer.isBuffer(senderKey) ? senderKey : b4a.from(senderKey, 'hex')
	stringSender = senderKey.toString('hex') 

  log({ type: 'derive-topic', data: { text: 'feedkey to use in topic', feedkey }})
  feedkey = Buffer.isBuffer(feedkey) ? feedkey : b4a.from(feedkey, 'hex')
	stringfeed = feedkey.toString('hex') 

  receiverKey = Buffer.isBuffer(receiverKey) ? receiverKey : b4a.from(receiverKey, 'hex')
	stringReceiver = receiverKey.toString('hex') 

  id = id.toString()
  
  const concatinated = id + stringSender + stringfeed + stringReceiver
  
  const topic = datdot_crypto.get_hash(b4a.from(concatinated, 'hex'))
  log({ type: 'derive-topic', data: { text: 'derived key', topic: topic.toString('hex') }})
  return topic 
}

