const b4a = require('b4a')
const datdot_crypto = require('datdot-crypto')

module.exports = deriveTopicKey

function deriveTopicKey ({ id, senderKey, feedKey, receiverKey, log }) {
  senderKey = Buffer.isBuffer(senderKey) ? senderKey : b4a.from(senderKey, 'hex')
	stringSender = senderKey.toString('hex') 

  log({ type: 'derive-topic', data: { text: 'feedkey to use in topic', feedKey }})
  feedKey = Buffer.isBuffer(feedKey) ? feedKey : b4a.from(feedKey, 'hex')
	stringfeed = feedKey.toString('hex') 

  receiverKey = Buffer.isBuffer(receiverKey) ? receiverKey : b4a.from(receiverKey, 'hex')
	stringreceiver = receiverKey.toString('hex') 

  id = id.toString()
  
  const concatinated = id + stringSender + stringfeed + stringreceiver

  const derived = datdot_crypto.get_hash(b4a.from(concatinated, 'hex'))
  return derived 
}

