/******************************************************************************
  ROLE: user

    1. create account

******************************************************************************/

module.exports = register

async function register (vaultAPI, APIS) {
  const { name, log } = vaultAPI
  const { chainAPI } = APIS
  
  const nonce = await vaultAPI.getNonce()
  const myAddress = await vaultAPI.chainKeypair.address
  log({ type: 'peer', data: [`My address ${myAddress}`] })
  const signer = await vaultAPI.chainKeypair
  const noiseKey = await vaultAPI.noisePublicKey
  const signingPublicKey = await vaultAPI.signingPublicKey
  const data = { signingPublicKey, noiseKey }
  log({ type: 'peer', data: [`New account created => ${myAddress}, ${noiseKey.toString('hex')}`] })
  await chainAPI.newUser({ signer, nonce, data })
}
