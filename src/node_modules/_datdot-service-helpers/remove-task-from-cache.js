module.exports = remove_task_from_cache

async function remove_task_from_cache ({ account, feedkey, task_id, log }) {
    return new Promise(async (resolve, reject) => {
        const stringkey = feedkey.toString('hex')
        if (account.cache[stringkey]) { 
            log({ type: 'feed', data: { text: 'Removing task from feed storage', task_id, len: Object.keys(account.cache[stringkey].tasks).length, tasks: JSON.stringify(account.cache[stringkey].tasks) }})
            delete account.cache[stringkey].tasks[task_id]           
            if (!Object.keys(account.cache[stringkey].tasks).length) await storage.destroy(log)
            log({ type: 'feed', data: { text: 'Task removed from feed storage', task_id, len: Object.keys(account.cache[stringkey].tasks).length }})
            resolve()
        } else {
            log({ type: 'feed', data: { text: 'Trying to remove a non existing feed', stringkey }})
            reject()
        }
    })
}