module.exports = remove_task_from_cache

async function remove_task_from_cache ({ account, feed, swarmID, config, log }) {
    var tasks
    if (swarmID === 'intercept') tasks = account.cache['intercept'].tasks
    else if (swarmID === 'general') tasks = account.cache['general']
    else tasks = account.cache['fresh'][swarmID].tasks
    return new Promise(async (resolve, reject) => {
        const stringtopic = feed.discoveryKey.toString('hex')
        if (tasks[stringtopic]) { 
            log({ type: 'task', data: { text: 'Removing task for topic', tasks: tasks[stringtopic] }})
            tasks[stringtopic]--
            if (tasks[stringtopic] < 1) {
                await store.end_task({ stringtopic, log })
            }
            log({ type: 'task', data: { text: 'Task removed', tasks: tasks[stringtopic] }})
            resolve()
        } else {
            log({ type: 'task', data: { text: 'Error: Trying to remove a task for a non existing topic', stringtopic }})
            reject()
        }
    })
}