module.exports = remove_task_from_cache

async function remove_task_from_cache ({ store, topic, cache, log }) {
    return new Promise(async (resolve, reject) => {
        const tasks = cache.tasks
        log({ type: 'task', data: { text: 'Removing task from cache', tasks }})
        const stringtopic = topic.toString('hex')
        if (tasks[stringtopic]) { 
            log({ type: 'task', data: { text: 'Removing task for topic', stringtopic, tasks: tasks[stringtopic] }})
            tasks[stringtopic]--
            if (tasks[stringtopic] < 1) {
                await store.no_tasks({ stringtopic, log })
                log({ type: 'task', data: { text: 'Calling no_tasks', tasks: tasks[stringtopic] }})
            }
            log({ type: 'task', data: { text: 'Task removed', tasks: tasks[stringtopic] }})
            resolve()
        } else {
            log({ type: 'task', data: { text: 'Error: Trying to remove a task for a non existing topic', stringtopic }})
            reject()
        }
    })
}