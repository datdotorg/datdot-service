module.exports = hypercore_updated

function hypercore_updated (feed, log) {
  return new Promise(function (resolve, reject) {
    function onupdate (err, result) {
      log({ type: 'feed', data: { text: 'onupdate' }})
      if (err && err.message !== 'No update available from peers') reject(err)
      else resolve()
    }
    feed.ready(function () {
    if (feed.writable) resolve()
    if (feed.peers.length) {
      log({ type: 'feed', data: { text: 'feed peers length' }})
      feed.update({ ifAvailable: true }, onupdate)
    } else {
      feed.once('peer-add', function () {
        log({ type: 'feed', data: { text: 'once peer add' }})
        feed.update({ ifAvailable: true }, onupdate)
      })
    }
    })
  })
}