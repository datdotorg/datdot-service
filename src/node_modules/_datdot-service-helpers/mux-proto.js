const c = require('compact-encoding')

module.exports = {
  make_protocol,
  create_and_open_channel,
  // add_string_msg
}

async function make_protocol (mux, opts, cb) {
  mux.pair(opts, callback)
  const opened = await mux.stream.opened
  if (opened) callback()
  function callback () {
    console.log('is mux opened', mux.opened(opts))
    cb(mux.opened(opts))
  }
}

async function create_and_open_channel (mux, opts) {
  const channel = await mux.createChannel(opts)
  console.log({ text: 'mux proto - channel created' })
  if (!channel) return
  channel.open()
  console.log({ text: 'mux proto - channel opened' })
  return channel
}

// function add_string_msg (channel, onmessage) {
//   const msg = channel.addMessage({
//     encoding: c.string,
//     onmessage
//   })
//   console.log({ text: 'mux proto - string message type added' })
//   return msg
// }