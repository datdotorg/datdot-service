const c = require('compact-encoding')

module.exports = {
  make_protocol,
  create_and_open_channel,
  // add_string_msg
}

async function make_protocol (mux, opts, cb, log) {
  mux.pair(opts, cb)
  log({ type: 'mux-proto', data: { text: 'make protocol' } })
  const opened = await mux.stream.opened
  log({ type: 'mux-proto', data: { text: 'stream opened', opened } })
  if (opened) cb(mux.opened(opts))
}

function create_and_open_channel (mux, opts, log) {
  const channel = mux.createChannel(opts)
  log({ type: 'mux-proto', data: { text: 'channel created' } })
  if (!channel) return
  channel.open()
  log({ type: 'mux-proto', data: { text: 'channel opened' } })
  return channel

}