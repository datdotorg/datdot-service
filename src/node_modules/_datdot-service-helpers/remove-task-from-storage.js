module.exports = remove_task_from_storage

async function remove_task_from_storage ({ account, feedkey, task_id, log }) {
    return new Promise(async (resolve, reject) => {
        const stringkey = feedkey.toString('hex')
        if (account.storages.has(stringkey)) { 
            const storage = account.storages.get(stringkey)
            log({ type: 'feed', data: { text: 'Removing task from feed storage', task_id, len: Object.keys(storage.tasks).length }})
            delete storage.tasks[task_id]           
            if (!Object.keys(storage.tasks).length) await storage.destroy(log)
            log({ type: 'feed', data: { text: 'Task removed from feed storage', task_id, len: Object.keys(storage.tasks).length }})
            resolve()
        } else {
            log({ type: 'feed', data: { text: 'Trying to remove a non existing feed', stringkey }})
            reject()
        }
    })
}