const zlib = require('zlib')

const brotli = {
  compress: (data) => new Promise((resolve, reject) => {
    // TODO: refine options
    const deflater = new zlib.BrotliCompress({
      params: {
        [zlib.constants.BROTLI_PARAM_QUALITY]: zlib.constants.BROTLI_MAX_QUALITY
      }
    })
    deflater.end(data)
    deflater.on('data', encoded => {
      console.log('brotli compressed')
      resolve(encoded)
    })
  }),
  
  decompress: (encoded) => new Promise((resolve, reject) => {
    // TODO: refine options
    const inflater = new zlib.BrotliDecompress()
    inflater.end(encoded)
    inflater.on('data', decoded => {
      console.log('brotli decompressed', decoded )
      resolve(decoded)
    })
  })
}

module.exports = brotli
